---
title: "Kraken2 report"
author: "Ming Wang"
date: "`r Sys.Date()`"
output:
  html_document:
    highlight: tango
    toc: yes
    toc_float:
      collapsed: no
    keep_md: false
  word_document:
    toc: yes
  pdf_document:
    toc: yes
params:
  input_dir: ""
---

```{r setup, include=FALSE}
suppressPackageStartupMessages(library(knitr))

knitr::opts_chunk$set(fig.width  = 12, 
                      fig.height = 8, 
                      fig.path   = "Figures/",
                      eval       = TRUE,
                      echo       = FALSE,
                      cache      = FALSE,
                      prompt     = FALSE,
                      tidy       = FALSE,
                      comment    = NA,
                      message    = FALSE,
                      warning    = FALSE,
                      eval       = T,
                      rownames.print = FALSE)
```


```{r load pkg}
library(hiseqr)
library(knitr)
library(ggplot2)
library(dplyr)
```


```{r config, eval = T}
input_dir <- params$input_dir
input_dir <- normalizePath(input_dir)
f_list    <- list.files(input_dir, "*kraken2.report$", full.names = TRUE)
if(length(f_list) == 0) {
  stop("No *kraken2.report files detected")
}
```

## 1 Introduction

This report was generated based on the output of `Kraken2 --report out.report`, to display the content of `bacteria` in each sample. 

`Kraken2` ([github](https://github.com/DerrickWood/kraken2)) is a taxonomic sequence classifier, that assign taxonomic labels to HiSeq reads (adapter-trimmed). 

In the follwing tables, **unclassified** was the percentage of reads that not assiged to any bacteria (NCBI). 

**So the number unclassified expected close to 100.0, for the samples without bacteria contamination**



## 2 Parameters

> A rank code, indicating (U)nclassified, (R)oot, (D)omain, (K)ingdom, (P)hylum, (C)lass, (O)rder, (F)amily, (G)enus, or (S)pecies. Taxa that are not at any of these 10 ranks have a rank code that is formed by using the rank code of the closest ancestor rank with a number indicating the distance from that rank. E.g., "G2" is a rank code indicating a taxon is between genus and species and the grandparent taxon is at the genus rank


### 2.1 Tax level: Species (S)

```{r Species, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "S", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

### 2.2 Tax level: Genus (G)

```{r Genus, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "G", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```


### 2.3 Tax level: Family (F)

```{r Family, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "F", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

### 2.4 Tax level: Order (O)

```{r Order, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "O", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

### 2.5 Tax level: Class (C)

```{r Class, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "C", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

### 2.6 Tax level: Phylum (P)

```{r Phylum, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "P", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

### 2.7 Tax level: Kindom (K)

```{r Kindom, fig.width=7}
p <- plot_kraken2_report(input_dir, tax_level = "K", switch_axis = FALSE)

# show table
p$data %>% 
  dplyr::select(sample, total, name, hit_pct) %>% 
  tidyr::pivot_wider(names_from = "name", values_from = "hit_pct") %>%
  hiseqr::to_DT()

print(p)
```

**EOF**









































































